<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Utility.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">loxj001-01-mx</a> &gt; <a href="index.source.html" class="el_package">com.prueba.lox.batch.Utility</a> &gt; <span class="el_source">Utility.java</span></div><h1>Utility.java</h1><pre class="source lang-java linenums">package com.prueba.lox.batch.Utility;

import com.prueba.lox.batch.model_1.MovimientoDTO;
import com.prueba.lox.lib.r174.interfaz.LOXR174;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * Clase de soporte que centraliza herramientas comunes para el Batch.
 * Gestiona la inyección de la librería de negocio, la fecha de proceso (ODATE)
 * y el formateo de datos para el archivo de salida.
 */
<span class="fc" id="L14">public class Utility {</span>

    // Variable que almacena la fecha de operación (formato YYYYMMDD) recibida desde el Job
    private String odate;

    // Interfaz de la librería de negocio. Spring la inyecta para ejecutar la lógica en el Process
    private LOXR174 loxR174;

    // --- SECCIÓN: MÉTODOS DE ACCESO (ENCAPSULAMIENTO) ---

<span class="fc" id="L24">    public String getOdate() { return odate; }</span>
<span class="fc" id="L25">    public void setOdate(String odate) { this.odate = odate; }</span>

<span class="fc" id="L27">    public LOXR174 getLoxR174() { return loxR174; }</span>
<span class="fc" id="L28">    public void setLoxR174(LOXR174 loxR174) { this.loxR174 = loxR174; }</span>


    // --- SECCIÓN: FORMATEO PARA ARCHIVO DE SALIDA ---

    /**
     * SOBRECARGA 1: Formatea un objeto individual (DTO).
     * Se usa en el flujo actual donde el Reader lee fila por fila.
     * @param item Objeto con los datos de la consulta Oracle.
     * @return Línea de texto formateada para el archivo TXT.
     */
    public String complementDataContracts(MovimientoDTO item) {
        // Validación de seguridad para evitar NullPointerException
<span class="fc bfc" id="L41" title="All 2 branches covered.">        if (item == null) return &quot;&quot;;</span>

        // Retorna una línea con anchos fijos o delimitadores:
        // %-20s = String de 20 caracteres alineado a la izquierda
        // %10.2f = Decimal de 10 posiciones con 2 decimales
<span class="fc" id="L46">        return String.format(&quot;NOMBRE: %-20s | CUENTA: %-15s | MONTO: %10.2f | FECHA: %s&quot;,</span>
<span class="fc" id="L47">                item.getNombre(),</span>
<span class="fc" id="L48">                item.getNumeroCuenta(),</span>
<span class="fc" id="L49">                item.getMonto(),</span>
                this.odate);
    }

    /**
     * SOBRECARGA 2: Mantenida por compatibilidad si otros procesos envían listas.
     * @param listcontract Lista de mapas con datos genéricos.
     * @return String con múltiples líneas (una por cada contrato).
     */
    public String complementDataContracts(List&lt;Map&lt;String, Object&gt;&gt; listcontract) {
<span class="fc bfc" id="L59" title="All 4 branches covered.">        if (listcontract == null || listcontract.isEmpty()) return &quot;&quot;;</span>

<span class="fc" id="L61">        StringBuilder sb = new StringBuilder();</span>
<span class="fc bfc" id="L62" title="All 2 branches covered.">        for (Map&lt;String, Object&gt; contract : listcontract) {</span>
            // Extrae el ID usando la llave del mapa o pone N/A si no existe
<span class="fc" id="L64">            sb.append(&quot;CONTRATO: &quot;).append(contract.getOrDefault(&quot;CONTRATO_ID&quot;, &quot;N/A&quot;))</span>
<span class="fc" id="L65">                    .append(&quot; | FECHA: &quot;).append(this.odate)</span>
<span class="fc" id="L66">                    .append(&quot;\n&quot;); // Salto de línea para el archivo</span>
<span class="fc" id="L67">        }</span>
<span class="fc" id="L68">        return sb.toString();</span>
    }


    // --- SECCIÓN: GESTIÓN DE EVENTOS (COMUNICACIÓN CON LIBRERÍA) ---

    /**
     * Crea un mapa de control para notificar estatus globales (Éxito/Error).
     * @param status Ejemplo: &quot;OK&quot;, &quot;ERROR&quot;, &quot;FINISHED&quot;
     * @param message Descripción detallada del suceso.
     * @return Mapa estructurado para la interfaz LOXR174.
     */
    public Map&lt;String, Object&gt; getMapEvent(String status, String message) {
<span class="fc" id="L81">        Map&lt;String, Object&gt; mapEvent = new HashMap&lt;&gt;();</span>
<span class="fc" id="L82">        mapEvent.put(&quot;STATUS&quot;, status);   // Estado de la operación</span>
<span class="fc" id="L83">        mapEvent.put(&quot;MESSAGE&quot;, message); // Mensaje informativo</span>
<span class="fc" id="L84">        mapEvent.put(&quot;ODATE&quot;, this.odate);// Fecha de la ejecución</span>
<span class="fc" id="L85">        return mapEvent;</span>
    }

    /**
     * SOBRECARGA: Envía el objeto DTO completo a la librería.
     * Es CRUCIAL para que LOXR174Impl pueda extraer el número de cuenta
     * y realizar la segunda consulta dependiente.
     * @param status Ejemplo: &quot;PROCESS&quot;
     * @param item El objeto MovimientoDTO con toda la info de la fila.
     */
    public Map&lt;String, Object&gt; getMapEvent(String status, Object item) {
<span class="fc" id="L96">        Map&lt;String, Object&gt; mapEvent = new HashMap&lt;&gt;();</span>
<span class="fc" id="L97">        mapEvent.put(&quot;STATUS&quot;, status);</span>
<span class="fc" id="L98">        mapEvent.put(&quot;item&quot;, item);       // Aquí viaja la &quot;llave&quot; para la 2da consulta</span>
<span class="fc" id="L99">        mapEvent.put(&quot;ODATE&quot;, this.odate);</span>
<span class="fc" id="L100">        return mapEvent;</span>
    }


    // --- SECCIÓN: OTROS ---

    /**
     * Convierte cualquier objeto a String de forma segura.
     */
    public String obtenerFormatoSalida(Object data) {
<span class="fc bfc" id="L110" title="All 2 branches covered.">        return (data != null) ? data.toString() : &quot;&quot;;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>